<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with Fabricatr • fabricatr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">fabricatr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://declaredesign.org">DeclareDesign</a>
    </li>
    <li>
      <a href="http://randomizr.declaredesign.org">randomizr</a>
    </li>
    <li>
      <a href="http://fabricatr.declaredesign.org">fabricatr</a>
    </li>
    <li>
      <a href="http://estimatr.declaredesign.org">estimatr</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://discuss.declaredesign.org">Discussion Board</a>
</li>
<li>
  <a href="https://declaredesign.org">DeclareDesign home</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DeclareDesign/fabricatr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Getting Started with Fabricatr</h1>
                        <h4 class="author">Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys</h4>
            
            <h4 class="date">2017-08-24</h4>
          </div>

    
    
<div class="contents">
<p><code>fabricatr</code> is a package designed to help you imagine your data before you collect it. While many solutions exist for creating simulated datasets, <code>fabricatr</code> is specifically designed to make the creation of realistic social science datasets easy. In particular, we need to be able to imagine <strong>correlated</strong> data and <strong>heirarchical</strong> data.</p>
<p><code>fabricatr</code> is a member of the <code>DeclareDesign</code> software suite that includes the <code>r</code> packages <a href="randomizr.declaredesign.org">randomizr</a>, <a href="estimatr.declaredesign.org">estimatr</a>, and <a href="declaredesign.org">Declare Design</a>. <code>fabricatr</code> plays well with the <a href="https://www.tidyverse.org/">tidyverse</a>.</p>
<div id="basics" class="section level1">
<h1 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h1>
<p>The workhorse function is <code>fabricate_data</code>. You provide a number to <code>N</code>, then a series of named functions. A nice feature is that you can use <code>N</code> as an argument to any of the functions you supply. Later functions can depend on values defined earlier, making the creation of correlated data easy</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fabricatr)
my_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">N =</span> <span class="dv">5</span>, <span class="dt">Y =</span> <span class="kw">runif</span>(N), <span class="dt">Y2 =</span> Y<span class="op">*</span><span class="dv">5</span>)
my_data</code></pre></div>
<pre><code>##   ID          Y        Y2
## 1  1 0.63158948 3.1579474
## 2  2 0.08212853 0.4106427
## 3  3 0.79288651 3.9644326
## 4  4 0.12911714 0.6455857
## 5  5 0.72220569 3.6110285</code></pre>
</div>
<div id="heirarchical-data" class="section level1">
<h1 class="hasAnchor">
<a href="#heirarchical-data" class="anchor"></a>Heirarchical data</h1>
<p>We can create hierarchical data through use of the <code>level</code> function. In the example below, we create 2 cities, each with an elevation. We then create 3 citizens per city, each with an income.</p>
<p>There are three things to notice about this example:</p>
<ol style="list-style-type: decimal">
<li>The meaning of <code>N</code> changes. In the <code>cities</code> line, <code>N</code> means 2, the number of cities. In the <code>citizens</code> line, <code>N</code> means 3, the number of citizens.</li>
<li>The data created at the cities level is <strong>constant</strong> within cities. Each city has its own elevation. The data created at the citizens level is <strong>not</strong> constant within cities.</li>
<li>Variables created at a lower level can depend on variables created at a higher level. Citizen’s income depends on the elevation of cities.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">income =</span> <span class="kw">round</span>(elevation <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )
my_data</code></pre></div>
<pre><code>##   cities elevation citizens income
## 1      1  1434.346        1   6816
## 2      1  1434.346        2   5711
## 3      1  1434.346        3   6213
## 4      2  1622.389        4   7334
## 5      2  1622.389        5   7505
## 6      2  1622.389        6   6686</code></pre>
</div>
<div id="bringing-in-your-own-data" class="section level1">
<h1 class="hasAnchor">
<a href="#bringing-in-your-own-data" class="anchor"></a>Bringing in your own data</h1>
<p>An essential part of imagining your data before you collect it is the ability to build on the data you all ready have.</p>
<p>A second way you may wish to use existing data is bootstrap a new dataset from it, thereby preserving all the natural inter-correlations.</p>
<div id="modifying-existing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#modifying-existing-data" class="anchor"></a>Modifying existing data</h2>
<p>If you have already conducted a baseline survey, you may which to imagine how the endline may deviate from it. In this case, you will want to add new variables to your existing dataset. Notice that the meaning of <code>N</code> in the definition of <code>Y_post</code> automatically refers to the number of rows in the dataset provided to the <code>data</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">baseline_survey &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">N =</span> <span class="dv">5</span>, <span class="dt">Y_pre =</span> <span class="kw">rnorm</span>(N))

my_endline &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">data =</span> baseline_survey, 
                             <span class="dt">Y_post =</span> Y_pre <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N))
my_endline</code></pre></div>
<pre><code>##   ID      Y_pre    Y_post
## 1  1 -1.8056396 -3.389334
## 2  2  1.4585809  1.875520
## 3  3 -0.9814822 -1.187751
## 4  4 -2.0749899 -2.900416
## 5  5  1.1921642  1.325742</code></pre>
</div>
<div id="bootstrapping" class="section level2">
<h2 class="hasAnchor">
<a href="#bootstrapping" class="anchor"></a>Bootstrapping</h2>
<p>Suppose you wanted to bootstrap from your baseline survey.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bootsrapped_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resample_data.html">resample_data</a></span>(baseline_survey, <span class="dt">N =</span> <span class="dv">10</span>)
bootsrapped_data</code></pre></div>
<pre><code>##    ID      Y_pre
## 1   5  1.1921642
## 2   5  1.1921642
## 3   5  1.1921642
## 4   1 -1.8056396
## 5   1 -1.8056396
## 6   2  1.4585809
## 7   3 -0.9814822
## 8   5  1.1921642
## 9   1 -1.8056396
## 10  3 -0.9814822</code></pre>
<p>The real utility of this function comes when bootstrapping from hierarchical data. The example below takes a dataset that contains 2 cities, each with 3 citizens, then bootstraps to 3 cities, each with 5 citizens.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">income =</span> <span class="kw">round</span>(elevation <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )

my_data_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resample_data.html">resample_data</a></span>(my_data, <span class="dt">N =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>), <span class="dt">ID_labels =</span> <span class="kw">c</span>(<span class="st">"cities"</span>, <span class="st">"citizens"</span>))
my_data_<span class="dv">2</span></code></pre></div>
<pre><code>##    cities elevation citizens income
## 1       2  1189.198        4   5922
## 2       2  1189.198        4   5922
## 3       2  1189.198        4   5922
## 4       2  1189.198        6   5970
## 5       2  1189.198        6   5970
## 6       2  1189.198        6   5970
## 7       2  1189.198        4   5922
## 8       2  1189.198        4   5922
## 9       2  1189.198        4   5922
## 10      2  1189.198        6   5970
## 11      2  1189.198        6   5970
## 12      2  1189.198        6   5970
## 13      2  1189.198        6   5970
## 14      2  1189.198        6   5970
## 15      2  1189.198        6   5970</code></pre>
</div>
</div>
<div id="advanced-features" class="section level1">
<h1 class="hasAnchor">
<a href="#advanced-features" class="anchor"></a>Advanced Features</h1>
<div id="ns-that-vary" class="section level2">
<h2 class="hasAnchor">
<a href="#ns-that-vary" class="anchor"></a>Ns that vary</h2>
<p>When making hierarchical data, you may not want to have the same number of units at each level of the hierarchy. For example, in the example below, we want one city to have 2 citizens and the other city to have four:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="dt">income =</span> <span class="kw">round</span>(elevation <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )
my_data</code></pre></div>
<pre><code>##   cities elevation citizens income
## 1      1  1598.615        1   8675
## 2      1  1598.615        2   6028
## 3      2  1222.723        3   6518
## 4      2  1222.723        4   5343
## 5      2  1222.723        5   6207
## 6      2  1222.723        6   6076</code></pre>
<p>You can even have Ns that are determined by a function, enabling a <em>random</em> number of citizens per city:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">income =</span> <span class="kw">round</span>(elevation <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )
my_data</code></pre></div>
<pre><code>##    cities elevation citizens income
## 1       1  1275.729       01   4540
## 2       1  1275.729       02   8104
## 3       1  1275.729       03   7918
## 4       1  1275.729       04   7465
## 5       1  1275.729       05   4824
## 6       2  1707.898       06   7430
## 7       2  1707.898       07  14059
## 8       2  1707.898       08   6807
## 9       2  1707.898       09   9001
## 10      2  1707.898       10   6324</code></pre>
</div>
<div id="bringing-in-your-own-hierarchical-data" class="section level2">
<h2 class="hasAnchor">
<a href="#bringing-in-your-own-hierarchical-data" class="anchor"></a>Bringing in your own hierarchical data</h2>
<p>Suppose you had existing hierarchical data, and you wanted to add variables that respected the levels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_baseline_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">income =</span> <span class="kw">round</span>(elevation <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )

<span class="co"># add new variables at each level</span>
my_data &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">data =</span> my_baseline_data,
                 <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">density =</span> elevation <span class="op">/</span><span class="st"> </span><span class="dv">2</span>),
                 <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">wealth =</span> income <span class="op">-</span><span class="st"> </span><span class="dv">100</span>))

my_data</code></pre></div>
<pre><code>##   citizens cities income elevation  density wealth
## 1        1      1   4060  1031.414 515.7071   3960
## 2        2      1   5629  1031.414 515.7071   5529
## 3        3      1   5464  1031.414 515.7071   5364
## 4        4      2   5607  1044.679 522.3396   5507
## 5        5      2   4028  1044.679 522.3396   3928
## 6        6      2   4974  1044.679 522.3396   4874</code></pre>
</div>
</div>
<div id="tidyverse-integration" class="section level1">
<h1 class="hasAnchor">
<a href="#tidyverse-integration" class="anchor"></a>Tidyverse integration</h1>
<p>Because the functions in <code>fabricatr</code> take data and return data, they are easily slotted into a <code>tidyverse</code> workflow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

<span class="co"># letting higher levels depend on lower levels</span>

my_data &lt;-<span class="st"> </span>
<span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">income =</span> <span class="kw">round</span>(elevation <span class="op">*</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/group_by">group_by</a></span>(cities) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/mutate">mutate</a></span>(<span class="dt">pop =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/n">n</a></span>())

my_data</code></pre></div>
<pre><code>## Source: local data frame [5 x 5]
## Groups: cities [2]
## 
## # A tibble: 5 x 5
##   cities elevation citizens income   pop
##    &lt;chr&gt;     &lt;dbl&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;
## 1      1  1791.240        1   9994     2
## 2      1  1791.240        2   8928     2
## 3      2  1530.127        3   5131     3
## 4      2  1530.127        4   6192     3
## 5      2  1530.127        5   6962     3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-<span class="st"> </span>
<span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/reexports">data_frame</a></span>(<span class="dt">Y =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/dplyr/topics/sample">sample</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">2</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">lower_level =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">Y2 =</span> Y <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(N)))
my_data</code></pre></div>
<pre><code>##   Y lower_level       Y2
## 1 5           1 6.124862
## 2 5           2 5.566972
## 3 5           3 6.491212
## 4 3           4 3.614178
## 5 3           5 4.681353
## 6 3           6 4.149249</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      true
    </div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
