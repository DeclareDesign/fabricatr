<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started with Fabricatr • fabricatr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">fabricatr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting_started.html">Getting Started</a>
</li>
<li>
  <a href="../reference/">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://declaredesign.org">DeclareDesign</a>
    </li>
    <li>
      <a href="http://randomizr.declaredesign.org">randomizr</a>
    </li>
    <li>
      <a href="http://fabricatr.declaredesign.org">fabricatr</a>
    </li>
    <li>
      <a href="http://estimatr.declaredesign.org">estimatr</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://discuss.declaredesign.org">Discussion Board</a>
</li>
<li>
  <a href="http://declaredesign.org">DeclareDesign home</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DeclareDesign/fabricatr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Getting Started with Fabricatr</h1>
                        <h4 class="author">Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys</h4>
            
            <h4 class="date">2017-08-24</h4>
          </div>

    
    
<div class="contents">
<p><code>fabricatr</code> is a package designed to help you imagine your data before you collect it. While many solutions exist for creating simulated datasets, <code>fabricatr</code> is specifically designed to make the creation of realistic social science datasets easy. In particular, we need to be able to imagine <strong>correlated</strong> data and <strong>heirarchical</strong> data.</p>
<p><code>fabricatr</code> is a member of the <code>DeclareDesign</code> software suite that includes the <code>r</code> packages <a href="randomizr.declaredesign.org">randomizr</a>, <a href="estimatr.declaredesign.org">estimatr</a>, and <a href="declaredesign.org">Declare Design</a>. <code>fabricatr</code> plays well with the <a href="https://www.tidyverse.org/">tidyverse</a>.</p>
<div id="basics" class="section level1">
<h1 class="hasAnchor">
<a href="#basics" class="anchor"></a>Basics</h1>
<p>The workhorse function is <code>fabricate_data</code>. You provide a number to <code>N</code>, then a series of named functions. A nice feature is that you can use <code>N</code> as an argument to any of the functions you supply. Later functions can depend on values defined earlier, making the creation of correlated data easy</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(fabricatr)
my_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">N =</span> <span class="dv">5</span>, <span class="dt">Y =</span> <span class="kw">runif</span>(N), <span class="dt">Y2 =</span> Y*<span class="dv">5</span>)
my_data</code></pre></div>
<pre><code>##   ID         Y       Y2
## 1  1 0.6196706 3.098353
## 2  2 0.9409138 4.704569
## 3  3 0.3297580 1.648790
## 4  4 0.6333941 3.166971
## 5  5 0.3663013 1.831506</code></pre>
</div>
<div id="hierarchical-data" class="section level1">
<h1 class="hasAnchor">
<a href="#hierarchical-data" class="anchor"></a>Hierarchical data</h1>
<p>We can create hierarchical data through use of the <code>level</code> function. In the example below, we create 2 cities, each with an elevation. We then create 3 citizens per city, each with an income.</p>
<p>There are three things to notice about this example:</p>
<ol style="list-style-type: decimal">
<li>The meaning of <code>N</code> changes. In the <code>cities</code> line, <code>N</code> means 2, the number of cities. In the <code>citizens</code> line, <code>N</code> means 3, the number of citizens.</li>
<li>The data created at the cities level is <strong>constant</strong> within cities. Each city has its own elevation. The data created at the citizens level is <strong>not</strong> constant within cities.</li>
<li>Variables created at a lower level can depend on variables created at a higher level. Citizen’s income depends on the elevation of cities.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">income =</span> <span class="kw">round</span>(elevation *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )
my_data</code></pre></div>
<pre><code>##   cities elevation citizens income
## 1      1  1339.094        1   6991
## 2      1  1339.094        2   8796
## 3      1  1339.094        3   8175
## 4      2  1510.326        4   5597
## 5      2  1510.326        5   5892
## 6      2  1510.326        6   7642</code></pre>
</div>
<div id="bringing-in-your-own-data" class="section level1">
<h1 class="hasAnchor">
<a href="#bringing-in-your-own-data" class="anchor"></a>Bringing in your own data</h1>
<p>An essential part of imagining your data before you collect it is the ability to build on the data you all ready have.</p>
<p>A second way you may wish to use existing data is bootstrap a new dataset from it, thereby preserving all the natural inter-correlations.</p>
<div id="modifying-existing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#modifying-existing-data" class="anchor"></a>Modifying existing data</h2>
<p>If you have already conducted a baseline survey, you may which to imagine how the endline may deviate from it. In this case, you will want to add new variables to your existing dataset. Notice that the meaning of <code>N</code> in the definition of <code>Y_post</code> automatically refers to the number of rows in the dataset provided to the <code>data</code> argument.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">baseline_survey &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">N =</span> <span class="dv">5</span>, <span class="dt">Y_pre =</span> <span class="kw">rnorm</span>(N))

my_endline &lt;-<span class="st"> </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">data =</span> baseline_survey, 
                             <span class="dt">Y_post =</span> Y_pre +<span class="st"> </span><span class="kw">rnorm</span>(N))
my_endline</code></pre></div>
<pre><code>##   ID       Y_pre     Y_post
## 1  1 -1.42365111 -2.0117503
## 2  2 -0.07969871 -0.6510014
## 3  3 -1.64760837 -1.8337462
## 4  4  0.89080682  0.1074706
## 5  5  1.28514345  1.3979072</code></pre>
</div>
<div id="bootstrapping" class="section level2">
<h2 class="hasAnchor">
<a href="#bootstrapping" class="anchor"></a>Bootstrapping</h2>
<p>Suppose you wanted to bootstrap from your baseline survey.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bootsrapped_data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resample_data.html">resample_data</a></span>(baseline_survey, <span class="dt">N =</span> <span class="dv">10</span>)
bootsrapped_data</code></pre></div>
<pre><code>##    ID       Y_pre
## 1   3 -1.64760837
## 2   5  1.28514345
## 3   4  0.89080682
## 4   5  1.28514345
## 5   2 -0.07969871
## 6   5  1.28514345
## 7   1 -1.42365111
## 8   4  0.89080682
## 9   1 -1.42365111
## 10  3 -1.64760837</code></pre>
<p>The real utility of this function comes when bootstrapping from hierarchical data. The example below takes a dataset that contains 2 cities, each with 3 citizens, then bootstraps to 3 cities, each with 5 citizens.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">income =</span> <span class="kw">round</span>(elevation *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )

my_data_2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/resample_data.html">resample_data</a></span>(my_data, <span class="dt">N =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">5</span>), <span class="dt">ID_labels =</span> <span class="kw">c</span>(<span class="st">"cities"</span>, <span class="st">"citizens"</span>))
my_data_2</code></pre></div>
<pre><code>##    cities elevation citizens income
## 1       1  1386.161        3   6856
## 2       1  1386.161        3   6856
## 3       1  1386.161        3   6856
## 4       1  1386.161        3   6856
## 5       1  1386.161        2   7652
## 6       1  1386.161        2   7652
## 7       1  1386.161        2   7652
## 8       1  1386.161        2   7652
## 9       1  1386.161        3   6856
## 10      1  1386.161        3   6856
## 11      2  1150.165        4   4752
## 12      2  1150.165        5   7998
## 13      2  1150.165        5   7998
## 14      2  1150.165        6   6077
## 15      2  1150.165        5   7998</code></pre>
</div>
</div>
<div id="advanced-features" class="section level1">
<h1 class="hasAnchor">
<a href="#advanced-features" class="anchor"></a>Advanced Features</h1>
<div id="ns-that-vary" class="section level2">
<h2 class="hasAnchor">
<a href="#ns-that-vary" class="anchor"></a>Ns that vary</h2>
<p>When making hierarchical data, you may not want to have the same number of units at each level of the hierarchy. For example, in the example below, we want one city to have 2 citizens and the other city to have four:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">4</span>), <span class="dt">income =</span> <span class="kw">round</span>(elevation *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )
my_data</code></pre></div>
<pre><code>##   cities elevation citizens income
## 1      1  1100.300        1   5466
## 2      1  1100.300        2   4045
## 3      2  1949.345        3  10635
## 4      2  1949.345        4   7416
## 5      2  1949.345        5   6260
## 6      2  1949.345        6  11132</code></pre>
<p>You can even have Ns that are determined by a function, enabling a <em>random</em> number of citizens per city:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">6</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), <span class="dt">income =</span> <span class="kw">round</span>(elevation *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )
my_data</code></pre></div>
<pre><code>##   cities elevation citizens income
## 1      1  1885.203        1   6464
## 2      1  1885.203        2  12402
## 3      1  1885.203        3   7859
## 4      1  1885.203        4  10061
## 5      1  1885.203        5   9288
## 6      2  1559.138        6   8769</code></pre>
</div>
<div id="bringing-in-your-own-hierarchical-data" class="section level2">
<h2 class="hasAnchor">
<a href="#bringing-in-your-own-hierarchical-data" class="anchor"></a>Bringing in your own hierarchical data</h2>
<p>Suppose you had existing hierarchical data, and you wanted to add variables that respected the levels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_baseline_data &lt;-
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">income =</span> <span class="kw">round</span>(elevation *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  )

<span class="co"># add new variables at each level</span>
my_data &lt;-<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">data =</span> my_baseline_data,
                 <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">density =</span> elevation /<span class="st"> </span><span class="dv">2</span>),
                 <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">wealth =</span> income -<span class="st"> </span><span class="dv">100</span>))

my_data</code></pre></div>
<pre><code>##   citizens cities income elevation  density wealth
## 1        1      1   5655  1350.253 675.1266   5555
## 2        2      1   5113  1350.253 675.1266   5013
## 3        3      1   6038  1350.253 675.1266   5938
## 4        4      2   8589  1664.009 832.0047   8489
## 5        5      2   9270  1664.009 832.0047   9170
## 6        6      2   8368  1664.009 832.0047   8268</code></pre>
</div>
</div>
<div id="tidyverse-integration" class="section level1">
<h1 class="hasAnchor">
<a href="#tidyverse-integration" class="anchor"></a>Tidyverse integration</h1>
<p>Because the functions in <code>fabricatr</code> take data and return data, they are easily slotted into a <code>tidyverse</code> workflow:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

<span class="co"># letting higher levels depend on lower levels</span>

my_data &lt;-<span class="st"> </span>
<span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(
    <span class="dt">cities =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">2</span>, <span class="dt">elevation =</span> <span class="kw">runif</span>(<span class="dt">n =</span> N, <span class="dt">min =</span> <span class="dv">1000</span>, <span class="dt">max =</span> <span class="dv">2000</span>)),
    <span class="dt">citizens =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="dt">income =</span> <span class="kw">round</span>(elevation *<span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> N, <span class="dt">mean =</span> <span class="dv">5</span>)))
  ) %&gt;%
<span class="st">  </span><span class="kw">group_by</span>(cities) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pop =</span> <span class="kw">n</span>())

my_data</code></pre></div>
<pre><code>## # A tibble: 5 x 5
## # Groups:   cities [2]
##   cities elevation citizens income   pop
##    &lt;chr&gt;     &lt;dbl&gt;    &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt;
## 1      1  1139.494        1   6925     2
## 2      1  1139.494        2   7127     2
## 3      2  1277.370        3   3439     3
## 4      2  1277.370        4   6966     3
## 5      2  1277.370        5   7049     3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_data &lt;-<span class="st"> </span>
<span class="kw">data_frame</span>(<span class="dt">Y =</span> <span class="kw">sample</span>(<span class="dv">1</span>:<span class="dv">10</span>, <span class="dv">2</span>)) %&gt;%
<span class="st">  </span><span class="kw"><a href="../reference/fabricate_data.html">fabricate_data</a></span>(<span class="dt">lower_level =</span> <span class="kw"><a href="../reference/level.html">level</a></span>(<span class="dt">N =</span> <span class="dv">3</span>, <span class="dt">Y2 =</span> Y +<span class="st"> </span><span class="kw">rnorm</span>(N)))
my_data</code></pre></div>
<pre><code>##   Y lower_level        Y2
## 1 6           1 6.6159476
## 2 6           2 6.5937983
## 3 6           3 4.9188182
## 4 3           4 2.9920638
## 5 3           5 0.9715657
## 6 3           6 1.0705122</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      true
    </div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
